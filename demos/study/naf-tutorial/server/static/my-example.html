<html>
  <head>
    <script src="https://aframe.io/releases/0.7.0/aframe.min.js"></script>

    <!-- superhands -->
    <script src="https://cdn.rawgit.com/donmccurdy/aframe-extras/v4.1.2/dist/aframe-extras.min.js"></script>
    <script src="https://unpkg.com/super-hands@3.0.0/dist/super-hands.min.js"></script>

    <!-- networked aframe -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.4.5/socket.io.min.js"></script>
    <script src="easyrtc/easyrtc.js"></script>
    <script src="https://unpkg.com/networked-aframe/dist/networked-aframe.min.js"></script>

    <!-- extras -->
    <script src="https://unpkg.com/aframe-randomizer-components@^3.0.1/dist/aframe-randomizer-components.min.js"></script>
    <script src="https://unpkg.com/aframe-event-set-component@4.2.1/dist/aframe-event-set-component.min.js"></script>

    <script>
    AFRAME.registerComponent('spawn-in-circle', {
      schema: {
        radius: {type: 'number', default: 1}
      },

      init: function() {
        var el = this.el;
        var center = el.getAttribute('position');

        var angleRad = this.getRandomAngleInRadians();
        var circlePoint = this.randomPointOnCircle(this.data.radius, angleRad);
        var worldPoint = {x: circlePoint.x + center.x, y: center.y, z: circlePoint.y + center.z};
        el.setAttribute('position', worldPoint);

        var angleDeg = angleRad * 180 / Math.PI;
        var angleToCenter = -1 * angleDeg + 90;
        var rotationStr = '0 ' + angleToCenter + ' 0';
        el.setAttribute('rotation', rotationStr);
      },

      getRandomAngleInRadians: function() {
        return Math.random()*Math.PI*2;
      },

      randomPointOnCircle: function (radius, angleRad) {
        x = Math.cos(angleRad)*radius;
        y = Math.sin(angleRad)*radius;
        return {x: x, y: y};
      }
    });
    </script>
  </head>
  <body>
    <a-scene networked-scene="
      app: myApp;
      room: room1;
      debug: true;
    ">
    <a-assets>
      <!-- Templates -->

       <!-- Player -->
       <template id="player-template">
         <a-entity></a-entity>
       </template>

       <!-- Head -->
       <template id="head-template">
         <a-entity class="avatar">
           <a-sphere class="head"
             color="#ffffff"
             scale="0.45 0.5 0.4"
           ></a-sphere>
           <a-entity class="face"
             position="0 0.05 0"
           >
             <a-sphere class="eye"
               color="#efefef"
               position="0.16 0.1 -0.35"
               scale="0.12 0.12 0.12"
             >
               <a-sphere class="pupil"
                 color="#000"
                 position="0 0 -1"
                 scale="0.2 0.2 0.2"
               ></a-sphere>
             </a-sphere>
             <a-sphere class="eye"
               color="#efefef"
               position="-0.16 0.1 -0.35"
               scale="0.12 0.12 0.12"
             >
               <a-sphere class="pupil"
                 color="#000"
                 position="0 0 -1"
                 scale="0.2 0.2 0.2"
               ></a-sphere>
             </a-sphere>
           </a-entity>
         </a-entity>
       </template>

       <!-- leftHand -->
       <template id="left-hand-template">
         <a-entity
          static-body="shape: sphere; sphereRadius: 0.001"
           sphere-collider="objects: a-box"
           super-hands
           hand-controls="left">
           <a-box scale="0.1 0.1 0.1"></a-box>
         </a-entity>
       </template>
       <!-- rightHand -->
       <template id="right-hand-template">
         <a-entity
          static-body="shape: sphere; sphereRadius: 0.001"
           sphere-collider="objects: a-box"
           super-hands
           hand-controls="right">
           <a-box scale="0.1 0.1 0.1"></a-box>
         </a-entity>
       </template>
    </a-assets>

    <a-entity id="player"
    networked="template:#player-template;attachTemplateToLocal:false;"
    spawn-in-circle="radius:3"
    raycaster="objects: a-box"
    cursor="rayOrigin:mouse"
    super-hands="
       colliderEvent: raycaster-intersection;
       colliderEventProperty: els;
       colliderEndEvent: raycaster-intersection-cleared;
       colliderEndEventProperty: clearedEls"
    wasd-controls>
      <a-entity
      camera="userHeight: 1.6"
      look-controls
      networked="template:#head-template;attachTemplateToLocal:false;">
        <a-sphere class="head"
                random-color
                visible="false"
              ></a-sphere>
      </a-entity>

      <a-entity
        networked="template:#left-hand-template;"></a-entity>
      <a-entity
        networked="template:#right-hand-template;"></a-entity>
    </a-entity>

     <a-box
      hoverable grabbable stretchable draggable dropppable
      color="blue"
      position="0 0 -1"
      shadow
      event-set__dragdrop="_event: drag-drop; geometry.radius: 0.25; geometry.primitive: sphere"
      event-set__hoveron="_event: hover-start; material.opacity: 0.7; transparent: true"
      event-set__hoveroff="_event: hover-end; material.opacity: 1; transparent: false"
      event-set__dragon="_event: dragover-start; material.wireframe: true"
      event-set__dragoff="_event: dragover-end; material.wireframe: false"
      ></a-box>

    <!-- add random head & hand combo -->
    <!-- get head & hand models-->
    <!-- hand tracking-->
    <!-- face tracking-->





  </a-scene>
  </body>
  <script>
    // Define custom schema for syncing avatar color, set by random-color
    NAF.schemas.add({
      template: '#head-template',
      components: [
        'position',
        'rotation',
        {
          selector: '.head',
          component: 'material'
        }
      ]
    });
    NAF.schemas.add({
      template: '#player-template',
      components: [
        'position',
        'rotation'
      ]
    });
    NAF.schemas.add({
      template: '#left-hand-template',
      components: [
        'position',
        'rotation'
      ]
    });
    NAF.schemas.add({
      template: '#right-hand-template',
      components: [
        'position',
        'rotation'
      ]
    });
    // Called by Networked-Aframe when connected to server
    function onConnect () {
      console.log("onConnect");
    }
  </script>
</html>
