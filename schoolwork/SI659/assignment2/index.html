<html lang="en">

  <head>
    <meta charset="UTF-8">
    <title>SI659 Assignment 2: Resubmit</title>
    <script src="https://aframe.io/releases/0.8.2/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/donmccurdy/aframe-physics-system/v3.3.0/dist/aframe-physics-system.min.js"></script>
    <script src="https://cdn.rawgit.com/donmccurdy/aframe-extras/v4.1.2/dist/aframe-extras.min.js"></script>
    <script src="https://unpkg.com/super-hands@3.0.0/dist/super-hands.min.js"></script>
    <script src="https://rawgit.com/feiss/aframe-environment-component/master/dist/aframe-environment-component.min.js"></script>
    <script src="https://unpkg.com/aframe-event-set-component@4.2.1/dist/aframe-event-set-component.min.js"></script>
    <script src="js/daydream-component.js"></script>
  </head>
  <body>
    <a-scene  environment = "lighting:point;"
              physics="driver: worker; workerFps: 60; workerInterpolate: true; workerInterpBufferSize: 2; friction: 0.1; restitution: 0.7"
              >
      <a-assets id="assets">
        <!-- watering can Riofluo Agence événementiel street -->
        <a-asset-item id="wateringcan-model" src="models/wateringcan.gltf"></a-asset-item>
        <!-- sun - poly by Google -->
        <a-asset-item id="sun-model" src="models/sun.gltf"></a-asset-item>

        <a-mixin id="wateringcanMix" shadow class="moveable" dynamic-body="shape: box; mass: 2" gltf-model="#wateringcan-model" hoverable grabbable draggable droppable ></a-mixin>
        <a-mixin id="sunMix" shadow  class="moveable" dynamic-body="shape: sphere; mass: .2" gltf-model="#sun-model" light="type: directional; color: #FFF; intensity: 0.6" hoverable grabbable draggable droppable > </a-mixin>
      </a-assets>

      <!-- Player -->
      <a-entity wasd-controls id="player">
        <a-entity camera look-controls position="0 1.6 6"></a-entity>
        <a-entity id="righthand"
          raycaster="showLine: true"
          daydream-listener
          daydream-controls
          collision-filter="collisionForces: false"
          sphere-collider="objects: [dynamic-body]"
          static-body="shape: sphere"
          super-hands=" colliderEvent: raycaster-intersection;
                        colliderEventProperty: els;
                        colliderEndEvent:raycaster-intersection-cleared;
                        colliderEndEventProperty: clearedEls;"
        ></a-entity>
      </a-entity>

      <!-- Terrain -->
      <a-box width="75" height="0.1" depth="75" static-body visible="false"></a-box>
      <a-light></a-light>

      <!-- Furniture Menu -->
      <a-entity id="menu" position="2.3 3 1" rotation="0 45 0" >
        <a-entity  shadow geometry="primitive: plane" position="0 0 1.5" rotation="0 90 0" material="color: #fff; opacity:.5; side: double; emissive: #b7b7b7">
          <a-entity id="wateringcan" shadow event-set__mousedown="spawn(id)" gltf-model="#wateringcan-model" rotation="0 90 0" position=".1 -.237 -.2" animation="property:rotation; to: 45 90 0; dir:alternate; loop:2; startEvents: hover"></a-entity>
        </a-entity>
        <a-entity  shadow geometry="primitive: plane" position="0 0 3" rotation="0 90 0" material="color: #fff; opacity:.5; side: double; emissive: #b7b7b7">
            <a-entity id="sun" shadow onclick="spawn(id)" gltf-model="#sun-model" position=".036 .270 -.229" animation="property:rotation; to: 90 450 0; startEvents: hover"> </a-entity>
        </a-entity>
      </a-entity>

    </a-scene>
  </body>
  <script>

    var camera = document.querySelector('#player');
    var ycoord = camera.getAttribute("rotation");
    var scene = document.querySelector('a-scene');
    var controller = document.getElementById('righthand');
    var newObject;
    var intersectedObject;
    var intersectionLocation;


    window.addEventListener('action', function(e){
        if (e.detail.touch == "left"){
          camera.object3D.rotation.y += Math.PI/8;
        }
        if (e.detail.touch == "right") {
          camera.object3D.rotation.y -= Math.PI/8;
        }
        if (e.detail.trackpaddown==true){
          console.log("trackpad pressed down")

        }
        if (e.detail.trackpadup==true){
          console.log("trackpad released")
        }
    });

    // spawn on click and attach to raycaster - make draggable & grabbable
    window.addEventListener('intersection', function (e) {
      if (e.detail){
        intersectedObject = e.detail.objectid;
        intersectionLocation = e.detail.location;
        console.log("some stuff was intersected", intersectedObject, intersectionLocation)
      }
      else {
        console.log("intersection event, but no intersection data")
      }
    });

    function spawn(id){
      newObject = document.createElement('a-entity');
      newObject.setAttribute('mixin', id+"Mix");
      newObject.setAttribute("position", intersectionLocation)
      scene.appendChild(newObject);
      console.log("you made a ", id, "at", intersectionLocation, "!", newObject)
    }

    function movecamera(object){
      var newpos = document.getElementById(object.id).getAttribute("position")
      console.log("moving to", newpos)
      document.getElementById('player').setAttribute("position", newpos) ;
    }


  </script>
</html>
