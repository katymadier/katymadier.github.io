<html lang="en">

  <head>
    <meta charset="UTF-8">
    <title>SI659 Assignment 2: Resubmit</title>
    <script src="https://aframe.io/releases/0.8.2/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/donmccurdy/aframe-physics-system/v3.3.0/dist/aframe-physics-system.min.js"></script>
    <script src="https://cdn.rawgit.com/donmccurdy/aframe-extras/v4.1.2/dist/aframe-extras.min.js"></script>
    <script src="https://unpkg.com/super-hands@3.0.0/dist/super-hands.min.js"></script>
    <script src="https://rawgit.com/feiss/aframe-environment-component/master/dist/aframe-environment-component.min.js"></script>
    <script src="js/daydream-component.js"></script>
  </head>
  <body>
    <a-scene  stats
              environment = "lighting:point;"
              physics="driver: worker; workerFps: 60; workerInterpolate: true; workerInterpBufferSize: 2; friction: 0.1; restitution: 0.7"
              >
      <a-assets id="assets">
        <!-- flower - https://poly.google.com/view/eydI4__jXpi-->
        <a-asset-item id="plantModel" src="models/flower.gltf"></a-asset-item>
        <!-- watering can Riofluo Agence événementiel street -->
        <a-asset-item id="wateringcanModel" src="models/wateringcan.gltf"></a-asset-item>
        <!-- sun - poly by Google -->
        <a-asset-item id="sunModel" src="models/sun.gltf"></a-asset-item>

        <a-mixin id="plantMix" shadow class="moveable" gltf-model="#plantModel" dynamic-body="shape: box; mass: 2" hoverable grabbable draggable droppable ></a-mixin>
        <a-mixin id="wateringcanMix" shadow class="moveable" dynamic-body="shape: box; mass: 2" gltf-model="#wateringcanModel" hoverable grabbable draggable droppable ></a-mixin>
        <a-mixin id="sunMix" shadow  class="moveable" dynamic-body="shape: sphere; mass: .2" gltf-model="#sunModel" light="type: directional; color: #FFF; intensity: 0.6" hoverable grabbable draggable droppable></a-mixin>
      </a-assets>

      <!-- Player -->
      <a-entity wasd-controls id="player" position="0 0 6">
        <a-entity camera look-controls></a-entity>
        <a-entity id="righthand"
          raycaster="showLine: true; objects: moveable"
          daydream-listener
          collision-filter="collisionForces: false"
          laser-controls
          sphere-collider="objects: [dynamic-body]"
          static-body="shape: sphere"
          super-hands=" colliderEvent: raycaster-intersection;
                        colliderEventProperty: els;
                        colliderEndEvent:raycaster-intersection-cleared;
                        colliderEndEventProperty: clearedEls;"
        ></a-entity>
      </a-entity>

      <!-- Terrain -->
      <a-box width="75" height="0.1" depth="75" static-body visible="false"></a-box>
      <a-light></a-light>

      <!-- Menu -->
      <a-entity id="menu" position="2.3 3 1" rotation="0 45 0" >
        <a-entity shadow geometry="primitive: plane" position="0 0 0" rotation="0 90 0" material="color: #fff; opacity:.5; side: double; emissive: #b7b7b7">
          <a-entity id="plant" shadow="" onclick="spawn(id)" gltf-model="#plantModel" rotation="0 180 0" animation="property:scale; to:0.0036 0.0036 0.0036; dir:alternate;loop:2; startEvents:hover">
            </a-entity>
        </a-entity>
        <a-entity  shadow geometry="primitive: plane" position="0 0 1.5" rotation="0 90 0" material="color: #fff; opacity:.5; side: double; emissive: #b7b7b7">
          <a-entity id="wateringcan" shadow onclick="spawn(id)" gltf-model="#wateringcanModel" rotation="0 90 0"  animation="property:rotation; to: 45 90 0; dir:alternate; loop:2; startEvents: hover"></a-entity>
        </a-entity>
        <a-entity  shadow geometry="primitive: plane" position="0 0 3" rotation="0 90 0" material="color: #fff; opacity:.5; side: double; emissive: #b7b7b7">
            <a-entity id="sun" shadow onclick="spawn(id)" gltf-model="#sunModel" animation="property:rotation; to: 90 450 0; startEvents: hover"> </a-entity>
        </a-entity>
      </a-entity>

    </a-scene>
  </body>
  <script>

    var camera = document.querySelector('#player');
    var ycoord = camera.getAttribute("rotation");
    var scene = document.querySelector('a-scene');
    var controller = document.getElementById('righthand');
    var newObject;
    var intersectedObject;
    var intersectionLocation;


    window.addEventListener('action', function(e){
        if (e.detail.touch == "left"){
          camera.object3D.rotation.y += Math.PI/8;
        }
        if (e.detail.touch == "right") {
          camera.object3D.rotation.y -= Math.PI/8;
        }
        if (e.detail.trackpaddown==true){
          console.log("trackpad pressed down")

        }
        if (e.detail.trackpadup==true){
          console.log("trackpad released")
        }
    });

    // spawn on click and attach to raycaster - make draggable & grabbable
    window.addEventListener('intersection', function (e) {
      if (e.detail){
        intersectedObject = e.detail.objectid;
        intersectionLocation = e.detail.location;
        console.log("some stuff was intersected", intersectedObject, intersectionLocation)
      }
      else {
        console.log("intersection event, but no intersection data")
      }
    });

    function spawn(id){
      newObject = document.createElement('a-entity');
      newObject.setAttribute('mixin', id+"Mix");
      newObject.setAttribute("position", intersectionLocation)
      scene.appendChild(newObject);
      console.log("you made a ", id, "at", intersectionLocation, "!", newObject)
    }

    function movecamera(object){
      var newpos = document.getElementById(object.id).getAttribute("position")
      console.log("moving to", newpos)
      document.getElementById('player').setAttribute("position", newpos) ;
    }


  </script>
</html>
