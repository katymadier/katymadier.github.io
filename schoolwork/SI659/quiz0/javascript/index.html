<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Quiz 0: JavaScript</title>
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

  <style>
    .none {
      filter: none;
    }
    .pink {
      filter:url(#pink);
    }
    .yellow {
      filter:url(#yellow);
    }
    canvas {
      width: 100%
      height: 100%;
      background-color: #ccc;
    }
    #container {
      width: 100%;
      height: 100%;
      touch-action: none
    }
    #selected {
      top:0;
      position:absolute;
      width:50px;
      height:50px;
      background-color: white;
    }
    video {
      min-height: 100%;
      min-width: 100%;
      overflow: hidden;
      display: block;
    }
    body {
      margin: 0;
    }
  </style>
  </head>
  <body>
    <svg width="0" height="0" xmlns="http://www.w3.org/2000/svg" version="1.1">
    <defs>
      <filter id="svgfilter" x="0%" y="0%" width="100%" height="100%">
        <filter id="pink">
          <feColorMatrix result="original" id="svgcolormatrix" type="matrix" values="0.6 1.7 1.7 0.2 -0.1 0.1 0.5 0 0 0 0.3 0 1 0 0 0 0 0 1 -0.04"></feColorMatrix>
        </filter>
        <filter id="yellow">
          <feColorMatrix result="original" id="svgcolormatrix" type="matrix" values="0.6 1.7 1.7 0.2 -0.1 0.1 0.5 0 0.6 -0.1 -1 0.8 1 0 0.6 1.1 0 -0.7 0.5 -0.2"></feColorMatrix>
        </filter>
      </filter>
    </defs>
    </svg>
    <!-- <div id="container">

    </div> -->
    <canvas id="canvas"></canvas>
    <video id="video" autoplay></video>
    <div id="selected"></div>
    <script>

    // setting up scene
    console.log("canvas updating 57")
    var video = window.video = document.querySelector('video');
    var constraints = {
      video: {
          facingMode: "environment",
          video:true,
          audio:false
        }
    };

    //reading camera feed
    function handleSuccess(stream) {
      window.stream = stream;
      video.srcObject = stream;
    }
    function handleError(error) {
      console.log('navigator.getUserMedia error: ', error);
    }
    navigator.mediaDevices.getUserMedia(constraints).
        then(handleSuccess).catch(handleError);

    //set up canvas with video image
    var c = document.getElementById("canvas");
    var ctx = c.getContext("2d");
    var video = document.getElementById("video");

    video.addEventListener('play', function () {
        ctx.drawImage(video, 0, 0);
        console.log("playing", ctx)
    })

    function gettingColor(evt){
      var selected = document.getElementById("selected");
      var touches = evt.changedTouches;

      for (var i = 0; i < touches.length; i++) {
        let imageData = ctx.getImageData(touches[i].pageX, touches[i].pageY, 1, 1);
        ctx.putImageData(imageData, 0, 0);
        var r = imageData.data[0].toString(16)
        var g = imageData.data[1].toString(16)
        var b = imageData.data[2].toString(16)
        var a = imageData.data[3].toString(16)
        let color =  "#" + r + g + b + a;
        console.log("color for touch with identifier = " + color);
        ctx.fillstyle = color;
        selected.style.backgroundColor = color;
      }
    }

    //touch listener
      window.addEventListener('onload', function(x){
        console.log("onload", x)
        writeCanvas(x);
      })
       window.addEventListener('touchstart', function(x) {
         console.log("touchstart", x);
         gettingColor(x);

       });




       // handleStart(x);

       // if (screen.orientation.angle == 0) {
       //   // pink
       //   video.className = "none";
       // } else if (screen.orientation.angle == 90) {
       //   // yellow
       //   video.className = "pink";
       // } else if (screen.orientation.angle == 270) {
       //   // orange
       //   video.className = "yellow";
       // }


       // // from Mozilla
       // function copyTouch(touch) {
       //   return { identifier: touch.identifier, pageX: touch.pageX, pageY: touch.pageY };
       // }
       //

       // // from Mozilla
       // function colorForTouch(touch) {
       //   var r = touch.identifier % 16;
       //   var g = Math.floor(touch.identifier / 3) % 16;
       //   var b = Math.floor(touch.identifier / 7) % 16;
       //   r = r.toString(16); // make it a hex digit
       //   g = g.toString(16); // make it a hex digit
       //   b = b.toString(16); // make it a hex digit
       //   var color = "#" + r + g + b;
       //   console.log("color for touch with identifier " + touch.identifier + " = " + color);
       //   return color;
       // }
       //
       // // from Mozilla
       // function handleStart(evt) {
       //   var ongoingTouches = [];
       //   console.log("canvas updating 23")
       //   evt.preventDefault();
       //   console.log("touchstart.");
       //   var el = document.getElementsByTagName("canvas")[0];
       //   var ctx = el.getContext("2d");
       //   var touches = evt.changedTouches;
       //   console.log(touches);
       //
       //   for (var i = 0; i < touches.length; i++) {
       //     console.log("touchstart:" + i + "...");
       //     ongoingTouches.push(copyTouch(touches[i]));
       //     var color = colorForTouch(touches[i]);
       //     // ctx.beginPath();
       //     // ctx.arc(touches[i].pageX, touches[i].pageY, 4, 0, 2 * Math.PI, false);  // a circle at the start
       //
       //     ctx.fillStyle = color;
       //     ctx.fill();
       //     console.log("color", color);
       //     console.log("touchstart:" + i + ".");
       //   }
       // }


    </script>
  </body>
</html>
